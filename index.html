<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>O Poder do Dedo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f4f4f4;
      color: #333;
    }
    h1, h2, h3 {
      text-align: center;
    }
    .center {
      text-align: center;
    }
    .players-list, .log {
      margin: 10px 0;
    }
    .hidden {
      display: none;
    }
    .card-area {
      margin: 20px 0;
      padding: 10px;
      border: 2px dashed #aaa;
      min-height: 50px;
      text-align: center;
      background-color: #fff;
    }
    button {
      padding: 10px 15px;
      margin: 5px;
      cursor: pointer;
      font-size: 1rem;
    }
    .pause-message {
      background-color: #ffe6e6;
      color: #b30000;
      border: 1px solid #b30000;
      padding: 10px;
      margin: 10px 0;
    }
    .rule-active {
      background-color: #e6f7ff;
      padding: 10px;
      border: 1px solid #006080;
      margin: 10px 0;
    }
    .finger-power {
      background-color: #fff7e6;
      padding: 10px;
      border: 1px solid #995c00;
      margin: 10px 0;
    }
  </style>
</head>
<body>

<h1>O Poder do Dedo</h1>
<p class="center">Versão digital do jogo de doses. Divirtam-se e bebam com responsabilidade!</p>

<div id="setup">
  <h3>Quantos jogadores vão participar?</h3>
  <div class="center">
    <input type="number" id="numPlayers" min="2" max="20" value="4" />
    <button onclick="startGame()">Iniciar Jogo</button>
  </div>
</div>

<div id="gameArea" class="hidden">
  <h2>Jogadores</h2>
  <div class="players-list" id="playersList"></div>

  <h2>Rodada Atual</h2>
  <div class="card-area" id="cardArea">Clique em "Próxima Carta" para começar!</div>
  
  <!-- Exibição de regra ativa -->
  <div id="ruleArea" class="hidden"></div>

  <!-- Exibição de poder do dedo guardado -->
  <div id="fingerPowerArea"></div>

  <div class="center">
    <button id="drawCardBtn" onclick="drawCard()">Próxima Carta</button>
  </div>

  <div class="log" id="log"></div>
</div>

<script>
  // --------------------------
  // Variáveis principais
  // --------------------------
  let deck = [];              // Baralho
  let currentPlayerIndex = 0; // Índice do jogador da vez
  let direction = 1;          // Sentido do jogo (1 = horário, -1 = anti-horário)
  let players = [];           // Array de nomes de jogadores
  let ruleActive = "";        // Texto da regra ativa, se existir
  let fingerPowerHolders = []; // Quem está com a carta "Poder do Dedo" guardada

  // --------------------------
  // Montagem do baralho
  // --------------------------
  function createDeck() {
    // Naipes (poderiam ser usados para exibir, mas aqui não afeta a regra)
    const suits = ["♥","♦","♣","♠"];
    // Valores que importam pro jogo
    const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];

    let newDeck = [];

    // Cria as 52 cartas tradicionais
    for (let s = 0; s < suits.length; s++) {
      for (let r = 0; r < ranks.length; r++) {
        newDeck.push({
          rank: ranks[r],
          suit: suits[s]
        });
      }
    }

    // Adiciona 3 coringas
    for (let i = 0; i < 3; i++) {
      newDeck.push({ rank: "Joker", suit: "Coringa" });
    }

    return newDeck;
  }

  // Embaralha o array do baralho
  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // --------------------------
  // Início do jogo
  // --------------------------
  function startGame() {
    const num = document.getElementById('numPlayers').value;
    if (num < 2) {
      alert("Precisa ter pelo menos 2 jogadores!");
      return;
    }

    // Cria nomes básicos (você pode adaptar se quiser nomear cada pessoa manualmente)
    players = [];
    for (let i = 1; i <= num; i++) {
      players.push("Jogador " + i);
    }

    deck = createDeck();
    shuffle(deck);

    // Reset das variáveis
    currentPlayerIndex = 0;
    direction = 1;
    ruleActive = "";
    fingerPowerHolders = [];

    document.getElementById("setup").classList.add("hidden");
    document.getElementById("gameArea").classList.remove("hidden");
    updatePlayersList();
    updateCardArea("Clique em 'Próxima Carta' para iniciar a primeira jogada.");
    document.getElementById("ruleArea").classList.add("hidden");
    document.getElementById("fingerPowerArea").innerHTML = "";
    document.getElementById("log").innerHTML = "";
  }

  // Atualiza listagem de jogadores (só pra exibir quem é quem)
  function updatePlayersList() {
    const listDiv = document.getElementById("playersList");
    let html = "<ul>";
    for (let i = 0; i < players.length; i++) {
      html += "<li>" + (i === currentPlayerIndex ? "<strong>" : "");
      html += players[i];
      html += (i === currentPlayerIndex ? " (Vez)</strong>" : "");
      html += "</li>";
    }
    html += "</ul>";
    listDiv.innerHTML = html;
  }

  // Atualiza a área que mostra a carta/ação
  function updateCardArea(text) {
    document.getElementById("cardArea").innerHTML = text;
  }

  // Adiciona algo ao log
  function addLog(text) {
    const logDiv = document.getElementById("log");
    logDiv.innerHTML += "<div>" + text + "</div>";
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  // --------------------------
  // Lógica de passar a vez
  // --------------------------
  function nextPlayer() {
    // move para o próximo jogador no sentido atual
    currentPlayerIndex += direction;

    // se sair do limite, ajusta
    if (currentPlayerIndex < 0) {
      currentPlayerIndex = players.length - 1;
    } else if (currentPlayerIndex >= players.length) {
      currentPlayerIndex = 0;
    }

    updatePlayersList();
  }

  // Inverte sentido (carta 9)
  function reverseDirection() {
    direction *= -1;
  }

  // Pula próximo jogador (carta 10)
  function skipNext() {
    nextPlayer();
    addLog("Próximo jogador pulado!");
  }

  // --------------------------
  // Desenhar/próxima carta
  // --------------------------
  function drawCard() {
    if (deck.length === 0) {
      updateCardArea("O baralho acabou! Jogo encerrado.");
      return;
    }

    const card = deck.shift();
    let message = `<strong>${players[currentPlayerIndex]}</strong> tirou a carta: <strong>${card.rank}</strong>`;

    // Trata a carta
    handleCardEffect(card);

    // Log da carta
    addLog(`${players[currentPlayerIndex]} puxou [${card.rank}]`);
  }

  // --------------------------
  // Lidar com o efeito da carta
  // --------------------------
  function handleCardEffect(card) {
    let effectText = "";

    switch(card.rank) {
      case "A":
        effectText = `
          - Carta: A (1) <br/>
          - Você escolhe <strong>1 dose</strong> para alguém. 
        `;
        showPauseMessage(`Distribua 1 dose!`);
        break;

      case "2":
        effectText = `
          - Carta: 2 <br/>
          - Você escolhe <strong>2 doses</strong>: pode dar 2 para uma pessoa ou 1 para duas pessoas. 
        `;
        showPauseMessage(`Distribua 2 doses!`);
        break;

      case "3":
        effectText = `
          - Carta: 3 <br/>
          - Você escolhe <strong>3 doses</strong>: pode dar todas para uma pessoa ou para 3 pessoas diferentes. 
        `;
        showPauseMessage(`Distribua 3 doses!`);
        break;

      case "4":
        effectText = `
          - Carta: 4 (Marca de...) <br/>
          - O jogador diz uma marca (por ex: de carro). Os outros devem dizer outras marcas na sequência. <br/>
          - Continua até quem tirou a carta desistir (e beber 1 dose) ou alguém errar.
        `;
        break;

      case "5":
        effectText = `
          - Carta: 5 (Regra) <br/>
          - Você cria uma regra maluca, que todos devem seguir até surgir a "6" (Quebra regra) ou alguém beber pela galera. 
        `;
        setRuleActive();
        break;

      case "6":
        effectText = `
          - Carta: 6 (Quebra Regra) <br/>
          - Encerra qualquer regra que esteja em vigor. 
        `;
        clearRuleActive();
        break;

      case "7":
        effectText = `
          - Carta: 7 (Eu nunca...) <br/>
          - Você fala algo que "nunca" fez. Quem já fez, bebe. 
        `;
        showPauseMessage(`Acerte "Eu nunca" e faça quem já fez beber!`);
        break;

      case "8":
        effectText = `
          - Carta: 8 (Poder do Dedo) <br/>
          - Você pode usar a qualquer momento, colocando o dedo na mesa. O último a colocar o dedo bebe. <br/>
          - Fica guardada com você até usar.
        `;
        holdFingerPower(currentPlayerIndex);
        break;

      case "9":
        effectText = `
          - Carta: 9 (Inverte o Sentido) <br/>
          - Agora o jogo muda o sentido (horário/anti-horário). 
        `;
        reverseDirection();
        break;

      case "10":
        effectText = `
          - Carta: 10 (Pula) <br/>
          - Pula o próximo jogador.
        `;
        // Primeiro a mensagem, depois já pula
        setTimeout(() => {
          skipNext();
          updatePlayersList();
        }, 500);
        break;

      case "J":
        effectText = `
          - Carta: Valete (J) <br/>
          - Quem tirou a carta bebe 1 dose.
        `;
        showPauseMessage(`${players[currentPlayerIndex]} bebe 1 dose!`);
        break;

      case "Q":
        effectText = `
          - Carta: Dama (Q) <br/>
          - Todas as mulheres bebem 1 dose.
        `;
        showPauseMessage(`Todas as mulheres bebem 1 dose!`);
        break;

      case "K":
        effectText = `
          - Carta: Rei (K) <br/>
          - Todos os homens bebem 1 dose.
        `;
        showPauseMessage(`Todos os homens bebem 1 dose!`);
        break;

      case "Joker":
        effectText = `
          - Carta: Coringa (Joker) <br/>
          - Você pode escolher qualquer efeito de qualquer carta OU não fazer nada. Divirta-se! 
        `;
        showPauseMessage(`Coringa! Faça o que quiser...`);
        break;

      default:
        effectText = "Carta desconhecida... (??)";
    }

    // Mostra no painel
    updateCardArea(`
      <h3>${players[currentPlayerIndex]}</h3>
      <p>${effectText}</p>
    `);

    // Passa a vez (a não ser que seja uma carta que exige pular, mas isso já tratamos acima)
    // Damos um pequeno delay se for a carta 10, pra mensagem aparecer antes de pular
    if (card.rank !== "10") {
      setTimeout(() => {
        nextPlayer();
      }, 1000);
    } else {
      // Caso seja 10, a gente já configurou o skipNext com setTimeout ali em cima
      setTimeout(() => {
        nextPlayer();
      }, 1200);
    }

    updatePlayersList();
  }

  // --------------------------
  // Gerenciar Regra (carta 5 e 6)
  // --------------------------
  function setRuleActive() {
    // Vamos só pedir um prompt para o jogador inventar a regra
    let newRule = prompt("Invente a nova regra que todos devem seguir:");
    if (!newRule) {
      newRule = "Regra livre (o jogador não especificou...)";
    }
    ruleActive = newRule;
    const ruleDiv = document.getElementById("ruleArea");
    ruleDiv.classList.remove("hidden");
    ruleDiv.classList.add("rule-active");
    ruleDiv.innerHTML = "<strong>Regra em vigor:</strong> " + ruleActive;
    addLog("Regra criada: " + ruleActive);
  }

  function clearRuleActive() {
    ruleActive = "";
    const ruleDiv = document.getElementById("ruleArea");
    ruleDiv.classList.add("hidden");
    ruleDiv.classList.remove("rule-active");
    ruleDiv.innerHTML = "";
    addLog("Regra quebrada! Não há mais regra em vigor.");
  }

  // --------------------------
  // Gerenciar "Poder do Dedo" (carta 8)
  // --------------------------
  function holdFingerPower(playerIndex) {
    // Armazenar que esse jogador tem "Poder do Dedo"
    fingerPowerHolders.push(playerIndex);
    renderFingerPower();
  }

  function renderFingerPower() {
    // Mostra na tela quem tem o Poder do Dedo
    let html = "";
    fingerPowerHolders.forEach((pIndex) => {
      html += `
        <div class="finger-power">
          <strong>${players[pIndex]}</strong> está com "Poder do Dedo"! 
          <button onclick="activateFingerPower(${pIndex})">Usar agora</button>
        </div>
      `;
    });
    document.getElementById("fingerPowerArea").innerHTML = html;
  }

  function activateFingerPower(playerIndex) {
    // Quando a pessoa clica, ela usa o poder
    alert(players[playerIndex] + " usou o Poder do Dedo! O último a colocar o dedo na mesa bebe!!");
    addLog(players[playerIndex] + " USOU o Poder do Dedo!");
    // Remove do array
    fingerPowerHolders = fingerPowerHolders.filter((idx) => idx !== playerIndex);
    renderFingerPower();
    showPauseMessage("Alguém ficou por último e vai beber a dose!");
  }

  // --------------------------
  // Mostrar pausa p/ beber
  // --------------------------
  function showPauseMessage(text) {
    // Cria um aviso temporário dizendo que alguém tem que beber
    const pauseDiv = document.createElement("div");
    pauseDiv.className = "pause-message";
    pauseDiv.innerHTML = text;
    document.body.appendChild(pauseDiv);

    // Remove depois de alguns segundos ou ao clicar
    setTimeout(() => {
      if (pauseDiv && pauseDiv.parentNode) {
        pauseDiv.parentNode.removeChild(pauseDiv);
      }
    }, 3000);
  }
</script>

</body>
</html>

